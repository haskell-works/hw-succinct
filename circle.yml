machine:
  post:
    - curl https://nixos.org/nix/install | sh

dependencies:
  cache_directories:
    - "~/.ambiata"
    - "~/.cabal"
    - "~/.ghc"
  pre:
    - cp ./scripts/* ~/bin/
    - nox when deps nix-env -i ghc-7.10.3
    - nox when deps nix-env -i cabal-install-1.22.9.0
    - nox when deps s3cache down
    - nox when deps ./mafia lock
    - nox when deps ./mafia unlock
    - nox when deps ./mafia install hspec-discover
    - nox when deps ln -sf ~/.ambiata/mafia/bin/hspec-discover/bin/hspec-discover ~/bin/hspec-discover
  override:
    - echo "Suppress default Circle CI dependencies"
  post:
    - nox when deps s3cache up

test:
  override:
    - nox when test sleep 1000000
